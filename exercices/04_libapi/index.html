
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://example.com/exercices/04_libapi/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.3">
    
    
      
        <title>Exercice 04 - libAPI - Services Web</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="light-green">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#exercice-04-libapi" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
  

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../.." title="Services Web" class="md-header__button md-logo" aria-label="Services Web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Services Web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Exercice 04 - libAPI
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="light-green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Onglets" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Accueil
    </a>
  </li>

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../notes_de_cours/php/array/" class="md-tabs__link">
        Notes de cours
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../01_utilisation_api/" class="md-tabs__link">
        Exercices
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Services Web" class="md-nav__button md-logo" aria-label="Services Web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg>

    </a>
    Services Web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Accueil
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Notes de cours
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Notes de cours" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Notes de cours
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          PHP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="PHP" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          PHP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes_de_cours/php/array/" class="md-nav__link">
        Les tableaux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes_de_cours/php/json/" class="md-nav__link">
        Manipulation de données en JSON
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes_de_cours/php/file_get_contents/" class="md-nav__link">
        Effectuer un appel GET à un service web
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Exercices
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Exercices" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Exercices
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01_utilisation_api/" class="md-nav__link">
        01 - Utilisation d’un service web
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02_revision_php/" class="md-nav__link">
        02 - Revision PHP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequis" class="md-nav__link">
    Prérequis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-de-linstallation" class="md-nav__link">
    Test de l'installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure-du-projet" class="md-nav__link">
    Structure du projet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercices" class="md-nav__link">
    Exercices
  </a>
  
    <nav class="md-nav" aria-label="Exercices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#premiere-partie-routes" class="md-nav__link">
    Première partie - Routes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deuxieme-partie-documentation" class="md-nav__link">
    Deuxième partie - Documentation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troisieme-partie-filtre-tri-selection-et-pagination" class="md-nav__link">
    Troisième partie - Filtre, tri, sélection et pagination
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quatrieme-partie-revision-et-formatage-de-la-reponse" class="md-nav__link">
    Quatrième partie - Révision et formatage de la réponse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cinquieme-partie-utilisation-de-monolog" class="md-nav__link">
    Cinquième partie - Utilisation de Monolog
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sixieme-partie-middleware" class="md-nav__link">
    Sixième partie - Middleware
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="exercice-04-libapi">Exercice 04 - libAPI</h1>
<p>Pour cet exercice nous allons créer un répertoire de livres. Même si le sujet est assez simple, nous allons créer une api un  peu plus étoffer grâce au framework <a href="https://www.slimframework.com/">SLIM</a>. Cet exercice va être utiliser sur plusieurs cours, on va y intégrer petit à petit plusieurs notions essentielles, alors il est important de suivre chaque étape et de les compléter.</p>
<h2 id="prerequis">Prérequis</h2>
<ul>
<li>Ampps (ou une autre "stack" incluant au minimum Apache, MySQL et PHP) -  <a href="https://ampps.com/">https://ampps.com/</a></li>
<li>Composer - <a href="https://getcomposer.org/">https://getcomposer.org/</a></li>
</ul>
<h2 id="installation">Installation</h2>
<ul>
<li>Cloner le dépot suivant à la racine de votre répertoire "localhost" de Ampps (par défaut ça sera C:\Program Files\Ampps\www ) : <a href="https://github.com/ServiceWeb-H2022/base-slim-skeleton">https://github.com/ServiceWeb-H2022/base-slim-skeleton</a></li>
<li>Renommez le répertoire créé (base-slim-skeleton) pour <strong>libapi</strong>.</li>
<li>Roulez la commande <code>composer update</code> dans le répertoire de votre projet.</li>
<li>Créez une base de données nommée aussi <strong>libapi</strong></li>
<li>Modifier les informations de connexion à la base de données dans le fichier config/settings.php.</li>
<li>Rouler le script <code>ressource/sql/createUserTable.sql</code> dans la base de données crée pour tester la création d'un usager.</li>
</ul>
<h2 id="test-de-linstallation">Test de l'installation</h2>
<p>Vous devriez avoir accès maintenant aux routes suivantes. Testez les avec Postman et un navigateur pour la route de la documentation.</p>
<table>
<thead>
<tr>
<th>Méthode</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/</td>
<td>Message de bienvenue</td>
</tr>
<tr>
<td>GET</td>
<td>/docs</td>
<td>Documentation de l'api</td>
</tr>
<tr>
<td>POST</td>
<td>/users</td>
<td>Création d'un usager</td>
</tr>
</tbody>
</table>
<p>Pour la création d'un usager, ajouter dans le body de la requête l'information en JSON : </p>
<pre><code>{
    &quot;username&quot; : &quot;[username]&quot;,
    &quot;first_name&quot; : &quot;[first_name]&quot;,
    &quot;last_name&quot; : &quot;[last_name]&quot;,
    &quot;email&quot; : &quot;[email]&quot;
}
</code></pre>
<h2 id="structure-du-projet">Structure du projet</h2>
<ul>
<li><strong>/config</strong></li>
<li><strong>Bootstrap.php</strong><ul>
<li>Point d’entrée</li>
</ul>
</li>
<li><strong>Routes.php</strong><ul>
<li>C’est ici qu’on va définir les routes </li>
</ul>
</li>
<li><strong>Settings.php</strong><ul>
<li>Constantes de configuration. Par exemple les informations pour se connecter à la bd</li>
</ul>
</li>
<li><strong>Container.php</strong><ul>
<li>Fonctions “injectées” dans le constructeur.</li>
</ul>
</li>
<li>
<p><strong>Middleware.php</strong></p>
<ul>
<li>Code qui s’execute automatiquement avant ou après les requêtes. (Authentication)</li>
</ul>
</li>
<li>
<p><strong>/src</strong></p>
</li>
<li><strong>/action</strong><ul>
<li>Les controlleurs, un fichier par “action”</li>
</ul>
</li>
<li><strong>/domain</strong><ul>
<li><strong>/user</strong></li>
<li>Séparer la logique application de l’accès aux données</li>
<li><strong>/Repository</strong><ul>
<li>Accès aux données</li>
</ul>
</li>
<li><strong>/Service</strong><ul>
<li>Logique de l’api.</li>
<li>Chaque classe doit n’avoir qu’une seule responsabilitée</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>La route appelle une classe action, ensuite le bon service est appelé. Le service va chercher les données avec la classe repository correspondante.</p>
<h2 id="exercices">Exercices</h2>
<h3 id="premiere-partie-routes">Première partie - Routes</h3>
<p>Créez les routes suivantes pour compléter la gestion des utilisateurs : </p>
<table>
<thead>
<tr>
<th>Méthodes</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/users</td>
<td>Lister tous les usagers</td>
</tr>
<tr>
<td>GET</td>
<td>/users/{id}</td>
<td>Lister seulement l'usager avec le id en paramètre</td>
</tr>
<tr>
<td>PUT</td>
<td>/users/{id}</td>
<td>Modifier l'usager avec le id en paramètre</td>
</tr>
<tr>
<td>DELETE</td>
<td>/users/{id}</td>
<td>Supprimer l'usager avec le id en paramètre</td>
</tr>
</tbody>
</table>
<ul>
<li>Pour chaque route, créez une classe "action", "service" et "repository". </li>
<li>Testez ensuite vos routes avec Postman.</li>
</ul>
<h3 id="deuxieme-partie-documentation">Deuxième partie - Documentation</h3>
<p>Créez la documentation pour les routes déjà existantes. À partir de maintenant, pour chaque route que nous allons ajouter, on va créer en même temps la documentation. </p>
<ul>
<li>Renommez le fichier de documentation <code>resources/docs/base_slim_skeleton_v1.yaml</code> pour <code>libapi.yaml</code>. C'est dans ce fichier que vous allez écrire la documentation. Il y a déjà une partie de fait pour les routes qui était déjà présente.</li>
<li>Modifiez le code du fichier <code>src/Action/Docs/SwaggerUiAction.php</code> pour que la variable <code>$yamlFile</code> fasse référence à votre fichier renommé. </li>
<li>En vous inspirant de ce qui est déjà présent dans le fichier de documentation et du site <a href="https://swagger.io/docs/specification/about/">swagger.io</a>, rédigez la documentation pour les 4 routes que vous avez créé dans la première partie.</li>
<li>Une fois terminé elle devrait apparaitre dans la page affiché quand vous utilisez la route <code>/</code></li>
</ul>
<h3 id="troisieme-partie-filtre-tri-selection-et-pagination">Troisième partie - Filtre, tri, sélection et pagination</h3>
<p>À l'aide des notes de cours sur les bonnes pratiques de conception d'un api, révisez ce que vous avez fait jusqu'à maintenant et apporter des corrections à votre projet si nécessaire.</p>
<ul>
<li>Ajouter les options de filtre, tri, sélection de champs et de pagination seulement pour la route <code>GET /users</code></li>
</ul>
<h3 id="quatrieme-partie-revision-et-formatage-de-la-reponse">Quatrième partie - Révision et formatage de la réponse</h3>
<p>Dans le répertoire <code>resources/sql</code> vous devriez avoir un fichier nommé <strong>books_insert_data.zip</strong>. S'il n'est pas présent vous pouvez le récupérer depuis le liens suivant : <a href="https://github.com/ServiceWeb-H2022/base-slim-skeleton/blob/main/resources/sql/books_insert_data.zip">books_insert_data.zip</a>. Le fichier contient deux scripts SQL à exécuter, un de création de la table books et un autre d'insertion de données dans cette table. Une fois les données importées, ajoutez la route suivante à votre API</p>
<p><strong>Afficher la liste de tous les livres</strong></p>
<table>
<thead>
<tr>
<th>Méthode</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/livres</td>
<td>Liste de tous les livres</td>
</tr>
</tbody>
</table>
<ul>
<li>Vous devez ajouter une pagination à la route. L'usager doit pouvoir entrer le numéro de page qu'il souhaite, s'il n'entre rien la page 1 sera affichée par défaut. Le nombre de livre à afficher par page est de 20 et vous devez commencer au premier enregistrement. Ex : <code>/livres?page=2</code> affichera les livres 21 à 40.</li>
<li>Par défaut la liste sera afficher par ordre alphabétique selon le <strong>titre</strong> du livre, permettez de pouvoir afficher la liste selon un tri alphabétique inversé.</li>
<li>La réponse devra être en format JSON et respecter la structure suivante : </li>
</ul>
<pre><code class="language-json">{
    &quot;livres&quot; : [
        {
            &quot;id&quot; : &quot;24876258&quot;,
            &quot;title&quot; : &quot;The Aeronaut's Windlass&quot;,
            &quot;series&quot; : &quot;(The Cinder Spires #1)&quot;,
            &quot;cover_link&quot; : &quot;https://i.gr-assets.com/images/S/compressed.ph...&quot;,
            &quot;author&quot; : &quot;Jim Butcher&quot;,
            &quot;average_rating&quot; : &quot;4,17&quot;,
            &quot;isbn&quot; : &quot;0451466802&quot;,
            &quot;isbn13&quot; : &quot;9780451466808&quot;
        },
        {
            ...
        }
    ],
    &quot;page&quot; : 1,
    &quot;page_total&quot; : 247   
}
</code></pre>
<p><strong>Afficher la description d'un livre</strong></p>
<table>
<thead>
<tr>
<th>Méthode</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/livres/[id]/description</td>
<td>Affiche la description d'un livre selon son id</td>
</tr>
</tbody>
</table>
<p>La route doit permettre d'afficher la description d'un livre selon son id. Si le id n'existe pas, le code de statut 404 doit être retourné et un message d'erreur dans la réponse.</p>
<p>Format de la réponse quand le id existe : </p>
<pre><code class="language-json">{
    &quot;id&quot; : &quot;24876258&quot;,
    &quot;title&quot; : &quot;The Aeronaut's Windlass&quot;,
    &quot;description&quot; : &quot;Jim Butcher, the #1 New York Times bestselling author ...&quot;
}
</code></pre>
<p>Format de la réponse si le id n'existe pas : </p>
<pre><code class="language-json">{
    &quot;errors&quot; : {
        &quot;code&quot; : &quot;404&quot;,
        &quot;message&quot; : &quot;Le id [id] n'existe pas&quot;
    }
}
</code></pre>
<h3 id="cinquieme-partie-utilisation-de-monolog">Cinquième partie - Utilisation de Monolog</h3>
<p>Avant de continuer, faites un commit des modifications que vous avez apporté à votre projet jusqu'à maintenant : </p>
<ul>
<li>Le message du commit doit être "Exercice 04 partie 4 terminé"</li>
<li>Faites un push du commit sur votre dépôt GitHub</li>
<li>Créer maintenant une branche à votre projet nommée <code>Exercice04-5</code>.</li>
</ul>
<p>À l'aide des notes de cours sur l'utilisation de Monolog, faites en sorte qu'à chaque fois qu'on modifie un usager, un message d'événement s'inscrit dans un fichier de log avec les configurations suivantes : </p>
<ul>
<li>Nom du fichier de log : <strong>usersLog</strong></li>
<li>Identification du message : <strong>updateUser</strong></li>
<li>Niveau de sévérité : <strong>INFO</strong></li>
<li>Message : "L'usager <strong>username</strong> a été modifié : {<strong>les nouvelles valeur de l'usager</strong>}"</li>
</ul>
<p>Exemple de résultat</p>
<pre><code>[2022-02-11T06:43:08.169802+01:00] updateUser.INFO: L'usager mathProf a été modifié : {&quot;username&quot; : &quot;mathProf&quot;,&quot;first_name&quot; : &quot;Mathieu&quot;,&quot;last_name&quot; : &quot;Fréchette&quot;,&quot;email&quot; : &quot;frechette.mathieu@cegepvicto.ca&quot;
}
</code></pre>
<p>Une fois terminé, fusionner votre branche au projet principal en suivant ces étapes : </p>
<ul>
<li>Faites un commit des modifications avec le message "Exercice 04 partie 5 terminé"</li>
<li>Changer de branche pour revenir à la branche principale</li>
<li>Fusionner la branche <code>Exercice04-5</code> dans la branche principale</li>
<li>Faites un push du commit sur votre dépôt GitHub</li>
</ul>
<h3 id="sixieme-partie-middleware">Sixième partie - Middleware</h3>
<p>Faites le nécessaire pour qu'à <u>chaque requête</u> HTTP vers votre projet, les informations suivantes soit inscrite dans un fichier de log : </p>
<ul>
<li>L'identificateur de la ligne sera <strong>RouteLogMiddleware</strong></li>
<li>Le niveau de sévérité est <strong>INFO</strong></li>
<li>Ensuite ajoutez la méthode HTTP (GET, POST, PUT, PATCH, DELETE) utilisée</li>
<li>Suivra le nom de la route, les paramètres de la section "query" s'il y en a et le contenu du body</li>
</ul>
<p><strong>Exemple</strong></p>
<pre><code>[2022-01-30T13:44:25.145185-05:00] RouteLogMiddleware.INFO: GET /libapi/docs
[2022-01-30T13:44:25.145185-05:00] RouteLogMiddleware.INFO: GET /libapi/livres?page=3
[2022-02-14T06:49:19.833744+01:00] RouteLogMiddleware.INFO: GET /libapi/ {&quot;cle1&quot;:&quot;Valeur1&quot;,&quot;cle2&quot;:&quot;Valeur2&quot;}  
</code></pre>
<p><strong>Quelques pistes de solution</strong></p>
<ul>
<li>Créer un fichier php dans le répertoire src/Middleware qui contiendra votre code</li>
<li>Invoquer cette classe au niveau de l'application</li>
<li>Dans votre classe "middleware", la structure de la fonction <code>__invoke()</code> devrait ressembler à ceci : </li>
</ul>
<pre><code class="language-php">public function __invoke(
    Request $request, 
    RequestHandler $handler): Response
{
    // Cette ligne exécute la requête
    $response = $handler-&gt;handle($request);

    // Votre code ...

    return $response;
}
</code></pre>
<p>Pour récupérer les informations générales de la route</p>
<ul>
<li><a href="https://www.slimframework.com/docs/v4/cookbook/retrieving-current-route.html">https://www.slimframework.com/docs/v4/cookbook/retrieving-current-route.html</a></li>
</ul>
<p>Pour les paramètres dans la route</p>
<ul>
<li><a href="https://www.slimframework.com/docs/v4/objects/request.html#the-request-uri">https://www.slimframework.com/docs/v4/objects/request.html#the-request-uri</a></li>
</ul>
<p>Pour le contenu du body, on l'a déjà vu quand on le récupère pour traiter un requête POST.</p>
<ul>
<li><a href="https://www.slimframework.com/docs/v3/objects/request.html#the-request-body">https://www.slimframework.com/docs/v3/objects/request.html#the-request-body</a></li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Retour en haut de la page
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking"], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.config.lang": "fr", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Rechercher", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version.title": "S\u00e9lectionner la version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.37e9125f.min.js"></script>
      
    
  </body>
</html>